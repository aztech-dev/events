<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Events by aztech-dev</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Events</h1>
        <h2></h2>
        <a href="https://github.com/aztech-dev/events" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="aztechevents" class="anchor" href="#aztechevents" aria-hidden="true"><span class="octicon octicon-link"></span></a>aztech/events</h1>

<h2>
<a id="important-notice" class="anchor" href="#important-notice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Important notice</h2>

<p>This package is the main repository for aztech/events, and does not contain any code. Please refer
to the composer.json to view the list of the packages provided by this package.</p>

<h2>
<a id="stability" class="anchor" href="#stability" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stability</h2>

<p><a href="https://packagist.org/packages/aztech/events"><img src="https://poser.pugx.org/aztech/events/v/stable.png" alt="Latest Stable Version"></a>
<a href="https://packagist.org/packages/aztech/events"><img src="https://poser.pugx.org/aztech/events/v/unstable.png" alt="Latest Unstable Version"></a></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a id="via-composer" class="anchor" href="#via-composer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Via Composer</h3>

<p>Composer is the only supported way of installing <em>aztech/events</em> . Don't know Composer yet ? <a href="https://getcomposer.org/doc/00-intro.md">Read more about it</a>.</p>

<div class="highlight highlight-bash"><pre>$ composer require <span class="pl-s1"><span class="pl-pds">"</span>aztech/events<span class="pl-pds">"</span></span>:<span class="pl-s1"><span class="pl-pds">"</span>~1<span class="pl-pds">"</span></span></pre></div>

<h2>
<a id="autoloading" class="anchor" href="#autoloading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autoloading</h2>

<p>Add the following code to your bootstrap file :</p>

<div class="highlight highlight-php"><pre><span class="pl-s2"><span class="pl-k">require_once</span> <span class="pl-s1"><span class="pl-pds">'</span>vendor/autoload.php<span class="pl-pds">'</span></span>;</span></pre></div>

<h2>
<a id="concepts" class="anchor" href="#concepts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Concepts</h2>

<p><em>aztech/events</em> aims to provide a solid foundation to build event driven architectures in PHP. </p>

<p>The current mainstream approach in existing libraries is currently to produce and consume events within the same process (for example, during a single HTTP request). While this is fine in most cases,
it does not fit in well with distributed systems, where events need to cross process/host boundaries. This library attempts to solve that by decoupling totally the publish and the subscribe processes through the use of <em>event channels</em>. </p>

<p>An event channel is simply any resource to which data can be written to and retrieved later (read TCP socket, memory, shared memory, files, message queues...). When an event is published, it is serialized and written to a channel, instead of being dispatched to the event subscribers. </p>

<p>On the other end of the channel, a consumer is responsible for reading incoming events (synchronously or not, depending on the channel type used) and pushing them to a standard event dispatcher. The dispatcher used by the consumer is responsible for dispatching received events to your handlers.</p>

<p>This means you can publish and dispatch events using the following methods :</p>

<ul>
<li>
<a href="https://github.com/aztech-dev/event-bus-core-plugins">Native plugins</a>

<ul>
<li><a href="https://github.com/aztech-dev/event-bus-core-plugins/blob/master/doc/File.md">File</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-core-plugins/blob/master/doc/Socket.md">Socket</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-core-plugins/blob/master/doc/Memory.md">Memory</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-core-plugins/blob/master/doc/Pdo.md">Database via PDO (untested)</a></li>
</ul>
</li>
<li>
<a href="https://github.com/aztech-dev/event-bus-extra-plugins">Extra plugins</a>

<ul>
<li><a href="https://github.com/aztech-dev/event-bus-extra-amqp">AMQP</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-extra-mixpanel">Mixpanel</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-extra-stomp">STOMP</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-extra-redis">Redis</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-extra-wamp">Wamp</a></li>
<li><a href="https://github.com/aztech-dev/event-bus-extra-zmq">ZMQ</a></li>
</ul>
</li>
</ul>

<p>If you want to create and publish events, you will need to use a <strong>publisher</strong>.
If you want to consume published events, you will need to use a <strong>processor</strong>. 
A processor is responsible for receiving events via whatever transport it uses. The library provides hooks to which you can bind <strong>subscribers</strong>, which are simple event handlers.</p>

<p>Optionally, the library provides an Application object to which you can easily bind subscribers.</p>

<h2>
<a id="event-matching-rules" class="anchor" href="#event-matching-rules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Event matching rules</h2>

<p>In <em>events</em>, all events are published and subscribed to on topic basis. An event has to expose a category
property, which must return the topic to which the event belongs. It can be any word, or chain of words separated by dots. Each dot indicates a sub-topic.</p>

<p>Subscribers can then choose to subscribe to topic on an exact match basis, or by using wildcards to subscribe to multiple events.</p>

<h3>
<a id="using-wildcards" class="anchor" href="#using-wildcards" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using wildcards</h3>

<blockquote>
<p><strong>tl;dr</strong> Use '#' to match absolutely anything, '*' to match exactly one unknown word.</p>
</blockquote>

<p>Event category matching actually follows the <a href="https://svn.apache.org/repos/asf/qpid/trunk/qpid/specs/apache-filters.xml#section-legacy-amqp">AMQP topic specification</a>, which is quite flexible :</p>

<blockquote>
<p>The legacy-amqp-topic-binding filter consists of a described string value. The value value described by the type is interpreted as a pattern to match against the subject field of the Properties section of the message being evaluated.</p>

<p>The pattern is formed using zero or more tokens, with each token delimited by the "." character. The tokens "#" and "*" have special meanings.
The token consisting of the single character "*" matches a single word in the subject field.
The token consisting of the single character "#" matches zero or more words in the subject field.
Thus the filter value "*.stock.#" would match the subjects "usd.stock" and "eur.stock.db" but not "stock.nasdaq".</p>
</blockquote>

<p>Basically, a topic name must be composed of letters and/or numbers and dashes. Sub-topics can be 
specified by using dots :</p>

<pre><code>topic
topic.subtopic
topic.subtopic.leaf
</code></pre>

<p>You can use '*' as a wildcard to match exactly one component in a topic :</p>

<pre><code>topic.* will match with topic.subtopic, but not with topic nor topic.subtopic.leaf
</code></pre>

<p>There is also '#', which means 0 or more components :</p>

<pre><code># will match all possible topics. 
topic.# will match topic, topic.subtopic, and topic.subtopic.leaf and any subtopic of topic no matter its nesting level
topic.#.leaf will match topic.subtopic.leaf and topic.other.leaf and many others, but not topic.subtopic.other
</code></pre>

<p>To get check the latest truth table of event matching, please refer to the source of <code>Aztech\Events\Tests\Unit\CategoryMatchTruthTable</code>.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>For simplicity, there are factories available to create publishers and dispatchers.</p>

<p>Listed below are examples for some of the providers. The full documentation is available <a href="https://github.com/aztech-dev/events/tree/master/doc/plugins.md">here</a>.</p>

<h3>
<a id="basic-usage" class="anchor" href="#basic-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic usage</h3>

<div class="highlight highlight-php"><pre><span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">require_once</span> <span class="pl-s1"><span class="pl-pds">'</span>vendor/autoload.php<span class="pl-pds">'</span></span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">\Aztech\Events\Bus\Events</span>;</span>
<span class="pl-s2"><span class="pl-k">use</span> <span class="pl-s3">\Aztech\Events\Bus\Plugins\Plugins</span>;</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-s3">Plugins</span><span class="pl-k">::</span>loadMemoryPlugin();</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$publisher</span> <span class="pl-k">=</span> <span class="pl-s3">Events</span><span class="pl-k">::</span>createPublisher(<span class="pl-s1"><span class="pl-pds">'</span>memory<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2"><span class="pl-vo">$processor</span> <span class="pl-k">=</span> <span class="pl-s3">Events</span><span class="pl-k">::</span>createProcessor(<span class="pl-s1"><span class="pl-pds">'</span>memory<span class="pl-pds">'</span></span>);</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-c">// Subscribe to all events using a wildcard filter</span></span>
<span class="pl-s2"><span class="pl-vo">$processor</span><span class="pl-k">-&gt;</span>on(<span class="pl-s1"><span class="pl-pds">'</span>#<span class="pl-pds">'</span></span>, <span class="pl-st">function</span> (<span class="pl-s3">Event</span> <span class="pl-vo">$event</span>) {</span>
<span class="pl-s2">    <span class="pl-s3">echo</span> <span class="pl-s1"><span class="pl-pds">'</span>Received a new event : <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-vo">$event</span><span class="pl-k">-&gt;</span>getCategory();</span>
<span class="pl-s2">});</span>
<span class="pl-s2"></span>
<span class="pl-s2"><span class="pl-vo">$event</span> <span class="pl-k">=</span> <span class="pl-s3">\Aztech\Events\</span><span class="pl-s3">Events</span><span class="pl-k">::</span>create(<span class="pl-s1"><span class="pl-pds">'</span>category<span class="pl-pds">'</span></span>, <span class="pl-s3">array</span>(<span class="pl-s1"><span class="pl-pds">'</span>property<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s1"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>));</span>
<span class="pl-s2"><span class="pl-vo">$publisher</span><span class="pl-k">-&gt;</span>publish(<span class="pl-vo">$event</span>);</span></pre></div>

<p>Checkout the provider specific documentations for more usage examples.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/aztech-dev/events/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/aztech-dev/events/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/aztech-dev/events"></a> is maintained by <a href="https://github.com/aztech-dev">aztech-dev</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
